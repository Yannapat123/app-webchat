import { NextResponse } from 'next/server'
export type ChatMessage = {
    text: string
    from: 'line-user' | 'line-oa' | 'web'
    userId: string
    createdAt: number
}

export const messages: ChatMessage[] = []

export async function POST(req: Request) {
    const body = await req.json()
    const event = body.events?.[0]

    if (event?.type === 'message' && event.message.type === 'text') {
        const text = event.message.text
        const userId = event.source.userId

        // 1. เก็บข้อความจาก user
        messages.push({
            text,
            from: 'line-user',
            userId,
            createdAt: Date.now(),

        })


    }


    return NextResponse.json({ ok: true })


}
export async function GET() {
    return NextResponse.json(messages)
}

export async function DELETE() {
    messages.length = 0
    return NextResponse.json({ ok: true })
}
